<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
  <!-- Header -->

  <!-- Main Content -->
  <main class="container mx-auto px-4 py-8">
    <!-- Hero Section - Full width (12 columns) -->
    <div class="grid grid-cols-12 mb-12">
      <div class="col-span-12 text-center">
        <h2 class="text-4xl font-bold text-gray-900 mb-4">
          How AI Resume Screener works
        </h2>
        <p class="text-lg text-gray-600 max-w-3xl mx-auto">
          Speed up and simplify resume screening with our AI-powered tool.
          Upload resumes, set job criteria, and instantly determine the best
          candidates â€” effortlessly and accurately.
        </p>
      </div>
    </div>

    <!-- Three-Step Process - Each step takes 4 columns -->
    <div class="grid grid-cols-12 gap-8 mb-16">
      <!-- Step 1 - 4 columns -->
      <div class="col-span-12 md:col-span-4 text-center">
        <div
          class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <span class="text-2xl font-bold text-purple-600">1</span>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-2">
          Enter job details
        </h3>
        <p class="text-gray-600">
          Provide key information about the role you're hiring for, including
          required skills, experience, and qualifications.
        </p>
      </div>

      <!-- Step 2 - 4 columns -->
      <div class="col-span-12 md:col-span-4 text-center">
        <div
          class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <span class="text-2xl font-bold text-blue-600">2</span>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-2">Upload resumes</h3>
        <p class="text-gray-600">
          Easily add resumes from your
          <span class="font-medium text-gray-900">device</span>.
        </p>
      </div>

      <!-- Step 3 - 4 columns -->
      <div class="col-span-12 md:col-span-4 text-center">
        <div
          class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"
        >
          <span class="text-2xl font-bold text-green-600">3</span>
        </div>
        <h3 class="text-xl font-semibold text-gray-900 mb-2">
          Start screening
        </h3>
        <p class="text-gray-600">
          AI instantly reviews and ranks resumes, helping you quickly identify
          the most qualified candidates.
        </p>
      </div>
    </div>

    <!-- Main Application Interface -->
    <div class="grid grid-cols-12 gap-8 mb-16">
      <div class="col-span-12">
        <div class="bg-white rounded-lg shadow-lg p-6">
          <div class="grid grid-cols-12 gap-8">
            <!-- Left Side - Job Details (6 columns) -->
            <div class="col-span-12 lg:col-span-6">
              <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-2">
                  Job Details
                </h3>
                <p class="text-gray-600 text-sm mb-4">
                  Enter the job details for your candidates.
                </p>
                <!-- PrimeNG Editor Integration -->
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                  <p-editor
                    [(ngModel)]="text"
                    [style]="{ height: '320px' }"
                    class="w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  />

                </div>
              </div>
            </div>

            <!-- Right Side - Resume Upload (6 columns) -->
            <div class="col-span-12 lg:col-span-6">
              <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-2">
                  Resume(s)
                </h3>

                <!-- Upload Area using PrimeNG FileUpload -->
                <div class="card mb-4">
                  <p-toast></p-toast>
                  <p-fileupload
                    name="myfile[]"
                    [multiple]="true"
                    accept="application/pdf"
                    maxFileSize="10000000"
                    (onSelect)="onSelect($event)"
                    (onUpload)="onUpload($event)"
                    [auto]="false"
                  >
                    <ng-template
                      #header
                      let-files
                      let-chooseCallback="chooseCallback"
                      let-clearCallback="clearCallback"
                      let-uploadCallback="uploadCallback"
                    >
                      <div
                        class="flex flex-wrap justify-between items-center flex-1 gap-4"
                      >
                        <div class="flex gap-2">
                          <p-button
                            (onClick)="chooseCallback()"
                            icon="pi pi-file-pdf"
                            [rounded]="true"
                            [outlined]="true"
                            label="Choose"
                          />
                          <p-button
                            (onClick)="clearCallback()"
                            icon="pi pi-times"
                            [rounded]="true"
                            [outlined]="true"
                            severity="danger"
                            label="Clear"
                            [disabled]="!files || files.length === 0"
                          />
                        </div>
                        <!-- Removed the progress bar section -->
                      </div>
                    </ng-template>

                    <ng-template
                      #content
                      let-files
                      let-uploadedFiles="uploadedFiles"
                      let-removeFileCallback="removeFileCallback"
                      let-removeUploadedFileCallback="removeUploadedFileCallback"
                    >
                      <div class="flex flex-col gap-8 pt-4">
                        <!-- Selected Files (Clean version without "Pending" badges) -->
                        <div *ngIf="files?.length > 0">
                          <h5 class="text-lg font-semibold text-gray-900 mb-4">
                            Selected Files
                          </h5>
                          <div class="flex flex-wrap gap-4">
                            <div
                              *ngFor="let file of files; let i = index"
                              class="p-6 rounded-lg flex flex-col border border-gray-200 items-center gap-3 bg-gray-50 hover:bg-gray-100 transition-colors"
                            >
                              <div>
                                <i
                                  class="pi pi-file-pdf text-3xl text-blue-600"
                                ></i>
                              </div>
                              <span
                                class="font-medium text-sm text-center text-ellipsis max-w-48 whitespace-nowrap overflow-hidden"
                                [title]="file.name"
                              >
                                {{ file.name }}
                              </span>
                              <div class="text-xs text-gray-500">
                                {{ formatSize(file.size) }}
                              </div>
                              <!-- Removed the "Pending" badge -->
                              <p-button
                                icon="pi pi-times"
                                (click)="
                                  onRemoveTemplatingFile(
                                    $event,
                                    file,
                                    removeFileCallback,
                                    i
                                  )
                                "
                                [outlined]="true"
                                [rounded]="true"
                                severity="danger"
                                size="small"
                              ></p-button>
                            </div>
                          </div>
                        </div>

                        <!-- Uploaded Files (Clean version) -->
                        <div *ngIf="uploadedFiles?.length > 0">
                          <h5 class="text-lg font-semibold text-gray-900 mb-4">
                            Ready for Analysis
                          </h5>
                          <div class="flex flex-wrap gap-4">
                            <div
                              *ngFor="let file of uploadedFiles; let i = index"
                              class="p-6 rounded-lg flex flex-col border border-green-200 items-center gap-3 bg-green-50"
                            >
                              <div>
                                <i
                                  class="pi pi-file-pdf text-3xl text-green-600"
                                ></i>
                              </div>
                              <span
                                class="font-medium text-sm text-center text-ellipsis max-w-48 whitespace-nowrap overflow-hidden"
                                [title]="file.name"
                              >
                                {{ file.name }}
                              </span>
                              <div class="text-xs text-gray-500">
                                {{ formatSize(file.size) }}
                              </div>
                              <!-- Clean status indicator without badge -->
                              <div
                                class="flex items-center gap-1 text-xs text-green-600"
                              >
                                <i class="pi pi-check-circle"></i>
                                <span>Ready</span>
                              </div>
                              <p-button
                                icon="pi pi-times"
                                (onClick)="removeUploadedFileCallback(i)"
                                [outlined]="true"
                                [rounded]="true"
                                severity="danger"
                                size="small"
                              ></p-button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </ng-template>

                    <ng-template #file></ng-template>

                    <ng-template #empty>
                      <div
                        class="flex items-center justify-center flex-col py-8"
                      >
                        <i
                          class="pi pi-cloud-upload !border-2 !rounded-full !p-8 !text-4xl !text-muted-color"
                        ></i>
                        <p class="mt-6 mb-0 text-gray-600">
                          Drag and drop PDF resumes here to upload.
                        </p>
                        <p class="text-sm text-gray-400 mt-2">
                          Or click "Choose" to select files
                        </p>
                      </div>
                    </ng-template>
                  </p-fileupload>

                  <!-- Manual upload button (cleaner version) -->
                  <div *ngIf="files.length > 0" class="mt-4 text-center">
                    <p-button
                      label="Upload {{ files.length }} File{{
                        files.length !== 1 ? 's' : ''
                      }}"
                      icon="pi pi-cloud-upload"
                      (onClick)="manualUpload()"
                      severity="success"
                      [loading]="isProcessing"
                    >
                    </p-button>
                  </div>
                </div>

                <!-- Dynamic Results Preview - Only show if there are results -->
                <div *ngIf="results.length > 0" class="space-y-3">
                  <h5 class="font-semibold text-gray-900">Quick Preview</h5>
                  <div
                    *ngFor="let result of results.slice(0, 3); let i = index"
                    class="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
                  >
                    <div class="flex items-center space-x-3">
                      <div
                        class="w-8 h-8 rounded flex items-center justify-center"
                        [ngClass]="getScoreBadgeClass(result.score)"
                      >
                        <span class="text-xs font-medium">
                          {{ i + 1 }}
                        </span>
                      </div>
                      <div>
                        <p class="text-sm font-medium text-gray-900">
                          {{ result.fileName }}
                        </p>
                        <p class="text-xs text-gray-500">
                          {{ getScoreLabel(result.score) }}
                        </p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="text-sm font-medium text-gray-900">
                        Match:
                        <span [ngClass]="getScoreColor(result.score)">
                          {{ result.score }}%
                        </span>
                      </p>
                    </div>
                  </div>

                  <!-- Show more indicator if there are more than 3 results -->
                  <div *ngIf="results.length > 3" class="text-center pt-2">
                    <p class="text-sm text-gray-500">
                      +{{ results.length - 3 }} more results below
                    </p>
                  </div>
                </div>

                <!-- Empty state when no files uploaded -->
                <div
                  *ngIf="uploadedFiles.length === 0 && results.length === 0"
                  class="text-center py-8"
                >
                  <i class="pi pi-upload text-4xl text-gray-400 mb-4"></i>
                  <p class="text-gray-500">No resumes uploaded yet</p>
                  <p class="text-sm text-gray-400">
                    Upload PDF files to get started
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading indicator -->
    <div *ngIf="isProcessing" class="mt-8 text-center">
      <div class="bg-white rounded-lg shadow-lg p-8">
        <div class="flex flex-col items-center">
          <div
            class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"
          ></div>
          <p class="text-gray-600 font-medium">Processing resumes...</p>
          <p class="text-sm text-gray-500">This may take a few moments</p>
        </div>
      </div>
    </div>

    <!-- Full Results Display Section -->
    <div *ngIf="hasResults && !isProcessing" class="mt-8">
      <div class="bg-white rounded-lg shadow-lg p-6">
        <div class="flex justify-between items-center mb-6">
          <h4 class="text-xl font-semibold text-gray-900">Analysis Results</h4>
          <div class="text-sm text-gray-500">
            {{ results.length }} candidate{{ results.length !== 1 ? "s" : "" }}
            analyzed
          </div>
        </div>

        <div class="space-y-4">
          <div
            *ngFor="let result of results; let i = index"
            class="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow"
          >
            <div class="flex items-start justify-between">
              <div class="flex items-start space-x-4 flex-1">
                <div
                  class="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold"
                  [ngClass]="getScoreBadgeClass(result.score)"
                >
                  {{ i + 1 }}
                </div>
                <div class="flex-1">
                  <!-- Update the photo badge to be clickable -->
                  <div class="flex items-center space-x-3 mb-2">
                    <h5 class="font-semibold text-gray-900">
                      {{ result.fileName }}
                    </h5>
                    <p-badge
                      *ngIf="result.hasPhoto && result.photoBase64"
                      value="ðŸ“· Photo"
                      severity="info"
                      class="cursor-pointer hover:opacity-80 transition-opacity"
                      (click)="showPhoto(result.photoBase64!)"
                      title="Click to view photo"
                    >
                    </p-badge>
                    <!-- Fallback if no photo data but hasPhoto is true -->
                    <p-badge
                      *ngIf="result.hasPhoto && !result.photoBase64"
                      value="ðŸ“· Photo"
                      severity="secondary"
                      title="Photo detected but not available for viewing"
                    >
                    </p-badge>
                  </div>
                  <p class="text-gray-600 mb-3">{{ result.summary }}</p>

                  <!-- Strengths -->
                  <div
                    *ngIf="result.strengths && result.strengths.length > 0"
                    class="mb-3"
                  >
                    <h6 class="text-sm font-medium text-green-700 mb-1">
                      Strengths:
                    </h6>
                    <div class="flex flex-wrap gap-2">
                      <span
                        *ngFor="
                          let strength of isExpanded(
                            result.resumeId,
                            'strengths'
                          )
                            ? result.strengths
                            : result.strengths.slice(0, 3)
                        "
                        class="px-2 py-1 bg-green-100 text-green-700 text-xs rounded-full"
                      >
                        {{ strength }}
                      </span>
                      <button
                        *ngIf="result.strengths.length > 3"
                        (click)="toggleExpansion(result.resumeId, 'strengths')"
                        class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full hover:bg-gray-200 transition-colors cursor-pointer border-none"
                      >
                        {{
                          isExpanded(result.resumeId, "strengths")
                            ? "Show less"
                            : "+" + (result.strengths.length - 3) + " more"
                        }}
                      </button>
                    </div>
                  </div>

                  <!-- Skills Match -->
                  <div
                    *ngIf="result.skillsMatch && result.skillsMatch.length > 0"
                    class="mb-3"
                  >
                    <h6 class="text-sm font-medium text-blue-700 mb-1">
                      Matching Skills:
                    </h6>
                    <div class="flex flex-wrap gap-2">
                      <span
                        *ngFor="
                          let skill of isExpanded(result.resumeId, 'skills')
                            ? result.skillsMatch
                            : result.skillsMatch.slice(0, 4)
                        "
                        class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded-full"
                      >
                        {{ skill }}
                      </span>
                      <button
                        *ngIf="result.skillsMatch.length > 4"
                        (click)="toggleExpansion(result.resumeId, 'skills')"
                        class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full hover:bg-gray-200 transition-colors cursor-pointer border-none"
                      >
                        {{
                          isExpanded(result.resumeId, "skills")
                            ? "Show less"
                            : "+" + (result.skillsMatch.length - 4) + " more"
                        }}
                      </button>
                    </div>
                  </div>

                  <!-- Weaknesses -->
                  <div
                    *ngIf="result.weaknesses && result.weaknesses.length > 0"
                  >
                    <h6 class="text-sm font-medium text-red-700 mb-1">
                      Areas of Concern:
                    </h6>
                    <div class="flex flex-wrap gap-2">
                      <span
                        *ngFor="
                          let weakness of isExpanded(
                            result.resumeId,
                            'weaknesses'
                          )
                            ? result.weaknesses
                            : result.weaknesses.slice(0, 2)
                        "
                        class="px-2 py-1 bg-red-100 text-red-700 text-xs rounded-full"
                      >
                        {{ weakness }}
                      </span>
                      <button
                        *ngIf="result.weaknesses.length > 2"
                        (click)="toggleExpansion(result.resumeId, 'weaknesses')"
                        class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full hover:bg-gray-200 transition-colors cursor-pointer border-none"
                      >
                        {{
                          isExpanded(result.resumeId, "weaknesses")
                            ? "Show less"
                            : "+" + (result.weaknesses.length - 2) + " more"
                        }}
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Score Display -->
              <div class="text-right ml-4">
                <div
                  class="text-3xl font-bold mb-1"
                  [ngClass]="getScoreColor(result.score)"
                >
                  {{ result.score }}%
                </div>
                <div class="text-sm font-medium text-gray-600">
                  {{ getScoreLabel(result.score) }}
                </div>
                <div class="text-xs text-gray-500 mt-1">Match Score</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Add this at the end of your HTML, before closing the main container -->
      <!-- Replace the p-dialog section (around lines 541-567) with this larger version: -->
      <p-dialog
        [(visible)]="showPhotoModal"
        [modal]="true"
        [closable]="true"
        [draggable]="false"
        [resizable]="true"
        header="Resume Photo"
        styleClass="photo-modal"
        (onHide)="hidePhoto()"
        [style]="{ width: '80vw', minWidth: '600px', maxWidth: '95vw' }"
        [maximizable]="true"
      >
        <div class="flex justify-center items-center p-4" *ngIf="selectedPhoto">
          <img
            [src]="'data:image/jpeg;base64,' + selectedPhoto"
            alt="Resume Photo"
            class="max-w-full max-h-full object-contain rounded-lg shadow-lg cursor-zoom-in"
            style="max-width: none; max-height: 80vh; width: auto"
            (click)="toggleImageZoom($event)"
            [ngClass]="{ 'cursor-zoom-out': isImageZoomed }"
          />
        </div>

        <ng-template pTemplate="footer">
          <div class="flex justify-between items-center w-full">
            <div class="text-sm text-gray-500">
              Click image to zoom {{ isImageZoomed ? "out" : "in" }}
            </div>
            <p-button
              label="Close"
              icon="pi pi-times"
              (onClick)="hidePhoto()"
              styleClass="p-button-secondary"
            ></p-button>
          </div>
        </ng-template>
      </p-dialog>
    </div>
  </main>
</div>

<router-outlet />
